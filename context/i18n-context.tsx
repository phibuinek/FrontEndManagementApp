import React, { createContext, useCallback, useContext, useMemo, useState } from 'react';

type Locale = 'vi' | 'en';

type Dictionary = Record<string, { vi: string; en: string }>;

const dictionary: Dictionary = {
  appTitle: { vi: 'Nail Salon', en: 'Nail Salon' },
  loginTitle: { vi: 'Đăng nhập hệ thống', en: 'Sign in to system' },
  username: { vi: 'Tên đăng nhập', en: 'Username' },
  password: { vi: 'Mật khẩu', en: 'Password' },
  currentPassword: { vi: 'Mật khẩu hiện tại', en: 'Current password' },
  newPassword: { vi: 'Mật khẩu mới', en: 'New password' },
  confirmPassword: { vi: 'Xác nhận mật khẩu', en: 'Confirm password' },
  login: { vi: 'Đăng nhập', en: 'Sign in' },
  loggingIn: { vi: 'Đang đăng nhập...', en: 'Signing in...' },
  saving: { vi: 'Đang lưu...', en: 'Saving...' },
  hello: { vi: 'Xin chào', en: 'Hello' },
  adminDashboard: { vi: 'Bảng điều khiển admin', en: 'Admin dashboard' },
  employeeDashboard: { vi: 'Bảng điều khiển nhân viên', en: 'Employee dashboard' },
  manageEmployees: { vi: 'Quản lý nhân viên', en: 'Manage employees' },
  manageCustomers: { vi: 'Quản lý khách hàng', en: 'Manage customers' },
  manageServices: { vi: 'Quản lý dịch vụ', en: 'Manage services' },
  appointments: { vi: 'Lịch hẹn', en: 'Appointments' },
  schedules: { vi: 'Lịch làm việc', en: 'Schedules' },
  assignments: { vi: 'Giao dịch vụ', en: 'Assignments' },
  commissions: { vi: 'Hoa hồng', en: 'Commissions' },
  payrolls: { vi: 'Bảng lương', en: 'Payrolls' },
  employeesTitle: { vi: 'Nhân viên', en: 'Employees' },
  customersTitle: { vi: 'Khách hàng', en: 'Customers' },
  servicesTitle: { vi: 'Dịch vụ', en: 'Services' },
  appointmentsTitle: { vi: 'Lịch hẹn', en: 'Appointments' },
  assignmentsTitle: { vi: 'Giao dịch vụ', en: 'Assignments' },
  schedulesTitle: { vi: 'Lịch làm việc', en: 'Work schedules' },
  commissionsTitle: { vi: 'Hoa hồng', en: 'Commissions' },
  employeeSchedule: { vi: 'Lịch làm việc (check-in)', en: 'Schedule (check-in)' },
  employeeAppointments: { vi: 'Lịch hẹn của tôi', en: 'My appointments' },
  employeeAssignments: { vi: 'Dịch vụ được giao + phí', en: 'Assigned services + fee' },
  employeeCommissions: { vi: 'Hoa hồng của tôi', en: 'My commissions' },
  employeePayrolls: { vi: 'Thu nhập của tôi', en: 'My earnings' },
  changePassword: { vi: 'Đổi mật khẩu', en: 'Change password' },
  changePasswordTitle: { vi: 'Đổi mật khẩu', en: 'Change password' },
  startWork: { vi: 'Bắt đầu', en: 'Start' },
  employeeAppointmentsTitle: { vi: 'Lịch hẹn của tôi', en: 'My appointments' },
  employeeAssignmentsTitle: { vi: 'Dịch vụ được giao', en: 'Assigned services' },
  employeeSchedulesTitle: { vi: 'Lịch làm việc', en: 'Work schedule' },
  employeeCommissionsTitle: { vi: 'Hoa hồng của tôi', en: 'My commissions' },
  employeeHeaderTitle: { vi: 'Nhân viên', en: 'Employee' },
  logout: { vi: 'Đăng xuất', en: 'Sign out' },
  overview: { vi: 'Tổng quan', en: 'Overview' },
  totalIncome: { vi: 'Tổng thu nhập', en: 'Total income' },
  ownerIncome: { vi: 'Thu nhập Nail Salon', en: 'Nail Salon income' },
  employeeIncome: { vi: 'Thu nhập của nhân viên', en: 'Employee income' },
  incomeByEmployee: { vi: 'Theo nhân viên', en: 'By employee' },
  serviceTotal: { vi: 'Tổng tiền dịch vụ', en: 'Service total' },
  quickActions: { vi: 'Truy cập nhanh', en: 'Quick actions' },
  searchPlaceholder: { vi: 'Tìm kiếm...', en: 'Search...' },
  searchEmployeesLabel: { vi: 'Tìm nhân viên', en: 'Search employees' },
  searchEmployeesPlaceholder: { vi: 'Nhập tên nhân viên...', en: 'Enter employee name...' },
  languageEn: { vi: 'EN', en: 'EN' },
  languageVi: { vi: 'VI', en: 'VI' },
  dayMon: { vi: 'T2', en: 'Mon' },
  dayTue: { vi: 'T3', en: 'Tue' },
  dayWed: { vi: 'T4', en: 'Wed' },
  dayThu: { vi: 'T5', en: 'Thu' },
  dayFri: { vi: 'T6', en: 'Fri' },
  daySat: { vi: 'T7', en: 'Sat' },
  daySun: { vi: 'CN', en: 'Sun' },
  publicBookingTitle: { vi: 'Đặt lịch hẹn', en: 'Book appointment' },
  publicBookingSubtitle: {
    vi: 'Chọn dịch vụ và khung giờ phù hợp để đặt lịch.',
    en: 'Choose a service and time that works for you.',
  },
  publicLandingTitle: { vi: 'Nail Salon', en: 'Nail Salon' },
  publicLandingSubtitle: {
    vi: 'Đặt lịch nhanh hoặc đăng nhập nhân viên/admin.',
    en: 'Quick booking or staff/admin login.',
  },
  publicLandingBadge: { vi: 'Nail Salon Studio', en: 'Nail Salon Studio' },
  landingChipRelax: { vi: 'Thư giãn', en: 'Relax' },
  landingChipPremium: { vi: 'Cao cấp', en: 'Premium' },
  landingChipFast: { vi: 'Nhanh gọn', en: 'Fast' },
  customerSectionTitle: { vi: 'Khách hàng', en: 'Customer' },
  customerSectionSubtitle: {
    vi: 'Đặt lịch hẹn không cần đăng nhập.',
    en: 'Book an appointment without logging in.',
  },
  staffSectionTitle: { vi: 'Nhân viên / Admin', en: 'Staff / Admin' },
  staffSectionSubtitle: {
    vi: 'Đăng nhập để quản lý và làm việc.',
    en: 'Sign in to manage and work.',
  },
  customerName: { vi: 'Tên khách hàng', en: 'Customer name' },
  customerPhone: { vi: 'Số điện thoại', en: 'Phone number' },
  bookAppointment: { vi: 'Đặt lịch', en: 'Book appointment' },
  bookAppointmentSuccess: { vi: 'Đặt lịch thành công', en: 'Appointment booked successfully' },
  errorPublicBookingRequired: {
    vi: 'Vui lòng nhập tên, số điện thoại, dịch vụ và thời gian',
    en: 'Please enter name, phone, service, and time',
  },
  optional: { vi: 'Tuỳ chọn', en: 'Optional' },
  clearSelection: { vi: 'Bỏ chọn', en: 'Clear selection' },
  back: { vi: 'Quay lại', en: 'Back' },
  searchCustomersLabel: { vi: 'Tìm khách hàng', en: 'Search customers' },
  searchCustomersPlaceholder: { vi: 'Nhập tên hoặc số điện thoại...', en: 'Enter name or phone...' },
  searchServicesLabel: { vi: 'Tìm dịch vụ', en: 'Search services' },
  searchServicesPlaceholder: { vi: 'Nhập tên dịch vụ...', en: 'Enter service name...' },
  searchAppointmentsLabel: { vi: 'Tìm lịch hẹn', en: 'Search appointments' },
  searchAppointmentsPlaceholder: { vi: 'Nhập tên khách, dịch vụ, nhân viên...', en: 'Enter customer, service, employee...' },
  searchAssignmentsLabel: { vi: 'Tìm giao dịch vụ', en: 'Search assignments' },
  searchAssignmentsPlaceholder: { vi: 'Nhập tên khách, dịch vụ, nhân viên...', en: 'Enter customer, service, employee...' },
  searchSchedulesLabel: { vi: 'Tìm lịch làm việc', en: 'Search schedules' },
  searchSchedulesPlaceholder: { vi: 'Nhập tên nhân viên hoặc ghi chú...', en: 'Enter employee or note...' },
  searchCommissionsLabel: { vi: 'Tìm hoa hồng', en: 'Search commissions' },
  searchCommissionsPlaceholder: { vi: 'Nhập tên khách hoặc dịch vụ...', en: 'Enter customer or service...' },
  searchPayrollsLabel: { vi: 'Tìm bảng lương', en: 'Search payrolls' },
  searchPayrollsPlaceholder: { vi: 'Nhập tên nhân viên...', en: 'Enter employee name...' },
  totalCustomers: { vi: 'Khách hàng', en: 'Customers' },
  totalServices: { vi: 'Dịch vụ', en: 'Services' },
  totalAppointments: { vi: 'Lịch hẹn', en: 'Appointments' },
  totalAssignments: { vi: 'Giao dịch vụ', en: 'Assignments' },
  todaySchedules: { vi: 'Lịch hôm nay', en: 'Today schedules' },
  pendingAssignments: { vi: 'Dịch vụ chờ', en: 'Pending services' },
  myCommissions: { vi: 'Hoa hồng', en: 'Commissions' },
  createPayroll: { vi: 'Tạo bảng lương', en: 'Create payroll' },
  editPayroll: { vi: 'Chỉnh sửa bảng lương', en: 'Edit payroll' },
  updatePayroll: { vi: 'Cập nhật bảng lương', en: 'Update payroll' },
  addEmployee: { vi: 'Thêm nhân viên', en: 'Add employee' },
  saveEmployee: { vi: 'Lưu nhân viên', en: 'Save employee' },
  employeeInfoTitle: { vi: 'Thông tin nhân viên', en: 'Employee details' },
  addCustomer: { vi: 'Thêm khách hàng', en: 'Add customer' },
  editCustomer: { vi: 'Chỉnh sửa khách hàng', en: 'Edit customer' },
  updateCustomer: { vi: 'Cập nhật khách hàng', en: 'Update customer' },
  addService: { vi: 'Thêm dịch vụ', en: 'Add service' },
  editService: { vi: 'Chỉnh sửa dịch vụ', en: 'Edit service' },
  updateService: { vi: 'Cập nhật dịch vụ', en: 'Update service' },
  createAppointment: { vi: 'Tạo lịch hẹn', en: 'Create appointment' },
  editAppointment: { vi: 'Chỉnh sửa lịch hẹn', en: 'Edit appointment' },
  updateAppointment: { vi: 'Cập nhật lịch hẹn', en: 'Update appointment' },
  createAssignment: { vi: 'Giao dịch vụ', en: 'Create assignment' },
  editAssignment: { vi: 'Chỉnh sửa giao dịch vụ', en: 'Edit assignment' },
  updateAssignment: { vi: 'Cập nhật giao dịch vụ', en: 'Update assignment' },
  createSchedule: { vi: 'Tạo lịch', en: 'Create schedule' },
  createScheduleTitle: { vi: 'Tạo lịch làm việc', en: 'Create schedule' },
  editSchedule: { vi: 'Chỉnh sửa lịch làm việc', en: 'Edit schedule' },
  updateSchedule: { vi: 'Cập nhật lịch', en: 'Update schedule' },
  selectEmployee: { vi: 'Chọn nhân viên', en: 'Select employee' },
  selectCustomer: { vi: 'Chọn khách hàng', en: 'Select customer' },
  selectService: { vi: 'Chọn dịch vụ', en: 'Select service' },
  assignEmployeeOptional: { vi: 'Chọn nhân viên (tuỳ chọn)', en: 'Select employee (optional)' },
  period: { vi: 'Kỳ', en: 'Period' },
  periodStart: { vi: 'Từ ngày', en: 'From date' },
  periodEnd: { vi: 'Đến ngày', en: 'To date' },
  earnings: { vi: 'Thu nhập', en: 'Earnings' },
  totalSalary: { vi: 'Tổng thu nhập', en: 'Total earnings' },
  serviceSales: { vi: 'Doanh thu dịch vụ', en: 'Service sales' },
  supplyFee: { vi: 'Phí vật tư', en: 'Supply fee' },
  netServiceSales: { vi: 'Doanh thu dịch vụ ròng', en: 'Net service sales' },
  serviceCommission: { vi: 'Hoa hồng dịch vụ', en: 'Service commission' },
  tip: { vi: 'Tip', en: 'Tip' },
  productSales: { vi: 'Doanh thu sản phẩm', en: 'Product sales' },
  workingHours: { vi: 'Giờ làm việc (giờ)', en: 'Working hours (hours)' },
  fee: { vi: 'Phí', en: 'Fee' },
  price: { vi: 'Giá', en: 'Price' },
  durationMinutes: { vi: 'Thời lượng (phút)', en: 'Duration (minutes)' },
  status: { vi: 'Trạng thái', en: 'Status' },
  time: { vi: 'Thời gian', en: 'Time' },
  schedule: { vi: 'Lịch', en: 'Schedule' },
  startAt: { vi: 'Bắt đầu', en: 'Start' },
  endAt: { vi: 'Kết thúc', en: 'End' },
  selectDateTime: { vi: 'Chọn ngày & giờ', en: 'Select date & time' },
  note: { vi: 'Ghi chú', en: 'Note' },
  owner: { vi: 'Nail Salon', en: 'Nail Salon' },
  employee: { vi: 'Nhân viên', en: 'Employee' },
  me: { vi: 'Tôi', en: 'Me' },
  phone: { vi: 'Số điện thoại', en: 'Phone' },
  displayName: { vi: 'Tên hiển thị', en: 'Display name' },
  role: { vi: 'Vai trò', en: 'Role' },
  roleEmployee: { vi: 'Nhân viên', en: 'Employee' },
  roleAdmin: { vi: 'Admin', en: 'Admin' },
  active: { vi: 'Trạng thái', en: 'Active' },
  yes: { vi: 'Có', en: 'Yes' },
  no: { vi: 'Không', en: 'No' },
  close: { vi: 'Đóng', en: 'Close' },
  edit: { vi: 'Chỉnh sửa', en: 'Edit' },
  delete: { vi: 'Xóa', en: 'Delete' },
  checkIn: { vi: 'Check-in', en: 'Check-in' },
  checkOut: { vi: 'Check-out', en: 'Check-out' },
  complete: { vi: 'Hoàn thành', en: 'Complete' },
  notCheckedIn: { vi: 'Chưa check-in', en: 'Not checked in' },
  notCheckedOut: { vi: 'Chưa check-out', en: 'Not checked out' },
  notAvailable: { vi: '-', en: '-' },
  statusScheduled: { vi: 'Đã lên lịch', en: 'Scheduled' },
  statusAssigned: { vi: 'Đã giao', en: 'Assigned' },
  statusCompleted: { vi: 'Hoàn thành', en: 'Completed' },
  statusCancelled: { vi: 'Đã hủy', en: 'Cancelled' },
  statusInProgress: { vi: 'Đang làm', en: 'In Progress' },
  selected: { vi: 'Đã chọn', en: 'Selected' },
  loginFailed: { vi: 'Đăng nhập thất bại', en: 'Login failed' },
  successTitle: { vi: 'Thành công', en: 'Success' },
  createSuccess: { vi: 'Tạo thành công', en: 'Created successfully' },
  assignmentCreated: { vi: 'Đã chuyển sang giao dịch vụ', en: 'Converted to assignment' },
  updateSuccess: { vi: 'Cập nhật thành công', en: 'Updated successfully' },
  deleteSuccess: { vi: 'Xóa thành công', en: 'Deleted successfully' },
  checkInSuccess: { vi: 'Check-in thành công', en: 'Checked in successfully' },
  lateCheckInTitle: { vi: 'Check-in trễ', en: 'Late check-in' },
  lateCheckInWarning: {
    vi: 'Bạn đã vào trễ {minutes} phút',
    en: 'You checked in late by {minutes} minutes',
  },
  checkOutSuccess: { vi: 'Check-out thành công', en: 'Checked out successfully' },
  completeSuccess: { vi: 'Hoàn thành thành công', en: 'Completed successfully' },
  changePasswordSuccess: { vi: 'Đổi mật khẩu thành công', en: 'Password changed successfully' },
  errorUsernameRequired: { vi: 'Vui lòng nhập username', en: 'Please enter username' },
  defaultPasswordHint: { vi: 'Để trống = mật khẩu mặc định', en: 'Leave blank = default password' },
  passwordSelfOnly: { vi: 'Nhân viên tự đổi mật khẩu trong tài khoản của mình', en: 'Employees change their own password in their account' },
  errorEmployeeRequired: { vi: 'Vui lòng chọn nhân viên', en: 'Please select an employee' },
  errorPayrollExistsThisMonth: {
    vi: 'Nhân viên đã có bảng lương trong tháng này',
    en: 'This employee already has a payroll for this month',
  },
  errorPayrollPeriod: { vi: 'Vui lòng nhập kỳ bảng lương', en: 'Please enter payroll period' },
  payrollExistsThisMonth: {
    vi: 'Đã có bảng lương tháng này',
    en: 'Payroll already exists for this month',
  },
  errorCustomerRequired: { vi: 'Vui lòng nhập tên khách hàng', en: 'Please enter customer name' },
  errorServiceRequired: { vi: 'Vui lòng nhập tên và giá dịch vụ', en: 'Please enter service name and price' },
  errorAppointmentRequired: { vi: 'Vui lòng chọn khách hàng, dịch vụ và thời gian', en: 'Please select customer, service, and time' },
  errorAppointmentCompleted: { vi: 'Lịch hẹn đã hoàn thành, không thể chỉnh sửa', en: 'Completed appointment cannot be edited' },
  errorScheduleConflict: { vi: 'Lịch hẹn bị trùng giờ với lịch đã có', en: 'Appointment time conflicts with existing schedule' },
  errorAppointmentPast: { vi: 'Không thể tạo lịch hẹn trong quá khứ', en: 'Cannot create appointment in the past' },
  errorAppointmentOutsideHours: {
    vi: 'Salon chỉ làm việc 7h–21h. Không thể đặt lịch ngoài khung giờ này.',
    en: 'Salon hours are 7:00–21:00. Cannot book outside this window.',
  },
  errorAssignmentRequired: { vi: 'Vui lòng chọn khách hàng, dịch vụ, nhân viên và phí', en: 'Please select customer, service, employee, and fee' },
  errorScheduleRequired: { vi: 'Vui lòng chọn nhân viên và thời gian', en: 'Please select employee and time' },
  errorSchedulePast: { vi: 'Không thể tạo lịch làm việc trong quá khứ', en: 'Cannot create work schedule in the past' },
  errorScheduleOutsideHours: {
    vi: 'Lịch làm việc phải trong khung 7h–21h.',
    en: 'Work schedule must be within 7:00–21:00.',
  },
  errorScheduleOverlapEmployee: {
    vi: 'Nhân viên đã có ca trùng giờ. Không thể xếp thêm ca trùng.',
    en: 'Employee already has an overlapping shift. Cannot assign another.',
  },
  errorScheduleEndBeforeStart: {
    vi: 'Giờ kết thúc phải sau giờ bắt đầu.',
    en: 'End time must be after start time.',
  },
  errorPasswordRequired: { vi: 'Vui lòng nhập đầy đủ mật khẩu', en: 'Please enter all password fields' },
  errorPasswordMismatch: { vi: 'Mật khẩu xác nhận không khớp', en: 'Password confirmation does not match' },
  customerFallback: { vi: 'Khách', en: 'Customer' },
  serviceFallback: { vi: 'Dịch vụ', en: 'Service' },
  employeeFallback: { vi: 'Nhân viên', en: 'Employee' },
  noData: { vi: 'Chưa có dữ liệu', en: 'No data' },
  customerNameVi: { vi: 'Tên khách (VI)', en: 'Customer name (VI)' },
  customerNameEn: { vi: 'Tên khách (EN)', en: 'Customer name (EN)' },
  serviceNameVi: { vi: 'Tên dịch vụ (VI)', en: 'Service name (VI)' },
  serviceNameEn: { vi: 'Tên dịch vụ (EN)', en: 'Service name (EN)' },
  customerNameLabel: { vi: 'Tên khách', en: 'Customer name' },
  serviceNameLabel: { vi: 'Tên dịch vụ', en: 'Service name' },
  viLabel: { vi: 'VI', en: 'VI' },
  enLabel: { vi: 'EN', en: 'EN' },
};

type I18nContextValue = {
  locale: Locale;
  toggleLocale: () => void;
  t: (key: keyof typeof dictionary) => string;
};

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocale] = useState<Locale>('vi');

  const toggleLocale = useCallback(() => {
    setLocale((prev) => (prev === 'vi' ? 'en' : 'vi'));
  }, []);

  const t = useCallback(
    (key: keyof typeof dictionary) => {
      const entry = dictionary[key];
      return entry ? entry[locale] : String(key);
    },
    [locale],
  );

  const value = useMemo(() => ({ locale, toggleLocale, t }), [locale, toggleLocale, t]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error('useI18n must be used within I18nProvider');
  }
  return ctx;
}
